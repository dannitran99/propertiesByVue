<template>
  <div class="scroll">
    <section class="panel-section testxx">
      <div class="report-hero hero-section">
        <svg viewBox="0 0 1920 1200" preserveAspectRatio="xMidYMid meet" text-rendering="geometricPrecision">
          <defs></defs>
          <g transform="translate(960,570)">
            <circle class="orbit fade-animation" r="170" fill="none" stroke="#243570" stroke-width="3"
              stroke-opacity="1" style="animation-delay: 0.1s">
            </circle>
            <circle class="orbit fade-animation" r="265" fill="none" stroke="#243570" stroke-width="3"
              stroke-opacity="1" style="animation-delay: 0.3s">
            </circle>
            <circle class="orbit-1 fade-animation" r="360" fill="none" stroke="#243570" stroke-width="3"
              stroke-opacity="1" style="animation-delay: 0.5s">
            </circle>
            <circle class="orbit fade-animation" r="455" fill="none" stroke="#243570" stroke-width="3"
              stroke-opacity="1" style="animation-delay: 0.7s">
            </circle>
            <circle class="orbit fade-animation" r="550" fill="none" stroke="#243570" stroke-width="3"
              stroke-opacity="1" style="animation-delay: 0.9s">
            </circle>
            <path id="path-planet-1" d="M-550,0 C-550,-303.75661 -303.75661,-550 0,-550" fill="none" />
            <path id="path-planet-2"
              d="M467.59736,-289.71653 C519.83518,-205.58426 550,-106.31481 550,0 550,303.75661 303.75661,550 0,550"
              fill="none" />
            <path id="path-planet-3" fill="none"
              d="M-367.21139,-268.71709 C-284.41899,-381.66424 -150.77374,-455 0,-455 188.46717,-455 350.17109,-340.41288 419.24384,-177.10653  " />
            <path id="path-planet-4" fill=" none"
              d="M-386.83054,239.67458 C-430.04547,170.07425 -455,87.95135 -455,0 -455,-175.90269 -355.18188,-328.49162 -209.0987,-404.21373  " />
            <path id="path-planet-5" fill="none"
              d="M360,0 C360,39.7645 353.5529,78.0232 341.64696,113.78784 294.0232,256.84641 159.05801,360 0,360 -69.58788,360 -134.56424,340.25576 -189.63264,306.06373  " />
            <g class="fade-animation planet-wrap-1" style="opacity: 1;animation-delay: 1.9s">
              <g class="planet" transform="rotate(180)">
                <circle class="breathing-animation" r="30" cx="550" cy="0" stroke="#1c2752" stroke-width="3"
                  fill="#fbd252"></circle>
                <g class="text-wrap item3" data-id="3" transform="rotate(-180, 550, 0)"><text class="value"
                    fill="#fbd252" font-family="&quot;Montserrat&quot;, sans-serif" font-size="35" font-weight="600"
                    x="550" y="0" dx="40" dy="-5">#3</text><text class="text" fill="#fff"
                    font-family="&quot;Montserrat&quot;, sans-serif" font-size="14" x="550" y="0" dx="40" dy="21">Đà
                    Nẵng</text></g>
                <rect class="planet-overlay" pointer-events="all" x="520" y="-42.38311767578125"
                  width="153.7108154296875" height="84.7662353515625" transform="rotate(-180, 550, 0)"
                  style="fill: transparent;"></rect>
              </g>
            </g>
            <g class="fade-animation planet-wrap-2" style="opacity: 1;animation-delay: 1.5s">
              <g class="planet" transform="rotate(342)">
                <circle class="breathing-animation" r="50" cx="550" cy="0" stroke="#1c2752" stroke-width="3"
                  fill="#ea514d"></circle>
                <g class="text-wrap item5" data-id="5" transform="rotate(-342, 550, 0)"><text class="value"
                    fill="#ea514d" font-family="&quot;Montserrat&quot;, sans-serif" font-size="51" font-weight="600"
                    x="550" y="0" dx="60" dy="-5">#1</text><text class="text" fill="#fff"
                    font-family="&quot;Montserrat&quot;, sans-serif" font-size="14" x="550" y="0" dx="60" dy="21">Tp Hồ
                    Chí Minh</text></g>
                <rect class="planet-overlay" pointer-events="all" x="500" y="-52.31671142578125"
                  width="254.1812744140625" height="104.6334228515625" transform="rotate(-342, 550, 0)"
                  style="fill: transparent;"></rect>
              </g>
            </g>
            <g class="fade-animation planet-wrap-3" style="opacity: 1;animation-delay: 1.7s">
              <g class="planet" transform="rotate(-139) scale(0.9999999999999999,0.9999999999999999)"
                fill-opacity="1.00" stroke-opacity="1.00">
                <circle class="breathing-animation-2" r="40" cx="455" cy="0" stroke="#1c2752" stroke-width="3"
                  fill="#42c3b0" transform="translate(0, 0) scale(1,1)"></circle>
                <g class="text-wrap item4" data-id="4"
                  transform="translate(798.3928590013613, -298.5068581906807) rotate(139) scale(0.9999999999999999,0.9999999999999999)">
                  <text class="value" fill="#42c3b0" font-family="&quot;Montserrat&quot;, sans-serif" font-size="45"
                    font-weight="600" x="455" y="0" dx="50" dy="-5">#2</text><text class="text" fill="#fff"
                    font-family="&quot;Montserrat&quot;, sans-serif" font-size="14" x="455" y="0" dx="50" dy="21">Hà
                    Nội</text>
                </g>
                <rect class="planet-overlay" pointer-events="all" x="415" y="-49.005516052246094"
                  width="167.0677490234375" height="98.01103210449219"
                  transform="translate(798.3928590013613, -298.5068581906807) rotate(139) scale(0.9999999999999999,0.9999999999999999)"
                  style="fill: transparent;"></rect>
              </g>
            </g>
            <g class="fade-animation planet-wrap-4" style="opacity: 1;animation-delay: 2.1s">
              <g class="planet" transform="rotate(152)" fill-opacity="1.00" stroke-opacity="1.00">
                <circle class="breathing-animation-2" r="20" cx="455" cy="0" stroke="#1c2752" stroke-width="3"
                  fill="#4494eb">
                </circle>
                <g class="text-wrap item2" data-id="2"
                  transform="translate(856.7411547508118, 213.60956106758027) rotate(-152)"><text class="value"
                    fill="#4494eb" font-family="&quot;Montserrat&quot;, sans-serif" font-size="29" font-weight="600"
                    x="455" y="0" dx="30" dy="-5">#4</text><text class="text" fill="#fff"
                    font-family="&quot;Montserrat&quot;, sans-serif" font-size="14" x="455" y="0" dx="30" dy="21">Bình
                    Dương</text></g>
                <rect class="planet-overlay" pointer-events="all" x="435" y="-38.40972900390625"
                  width="163.18035888671875" height="76.8194580078125"
                  transform="translate(856.7411547508118, 213.60956106758027) rotate(-152)" style="fill: transparent;">
                </rect>
              </g>
            </g>
            <g class="fade-animation planet-wrap-5" style="opacity: 1;animation-delay: 2.3s">
              <g class="planet" transform="rotate(14.999999999999998) skewX(0) scale(1,1)" fill-opacity="1.00"
                stroke-opacity="1.00">
                <circle class="breathing-animation-3" r="10" cx="360" cy="0" stroke="#1c2752" stroke-width="3"
                  fill="#c15eb1"
                  transform="translate(26.257075805047144, 0) scale(0.9270636783193135,0.9270636783193135)"></circle>
                <g class="text-wrap item1" data-id="1"
                  transform="translate(12.266702535935394, 93.17485623690746) rotate(-14.999999999999998) skewX(0) scale(1,1)">
                  <text class="value" fill="#c15eb1" font-family="&quot;Montserrat&quot;, sans-serif" font-size="20"
                    font-weight="600" x="360" y="0" dx="20" dy="-5">#5</text><text class="text" fill="#fff"
                    font-family="&quot;Montserrat&quot;, sans-serif" font-size="14" x="360" y="0" dx="20" dy="21">Đồng
                    Nai</text>
                </g>
                <rect class="planet-overlay" pointer-events="all" x="350" y="-32.4495849609375" width="119.38134765625"
                  height="64.899169921875"
                  transform="translate(12.266702535935394, 93.17485623690746) rotate(-14.999999999999998) skewX(0) scale(1,1)"
                  style="fill: transparent;"></rect>
              </g>
            </g>
          </g>
        </svg>
        <div class="titlewrap-hero txt-animation">
          <h1>GIẢI PHÁP NGHIÊN CỨU THỊ TRƯỜNG</h1>
        </div>
      </div>
    </section>
    <section class="test panel-section x-100">
      abc
    </section>
    <section class="test panel-section x-100">
      abcccc
    </section>
  </div>
</template>

<script>
import { gsap } from 'gsap'
import { ScrollTrigger } from 'gsap/ScrollTrigger'
import { MotionPathPlugin } from 'gsap/MotionPathPlugin'
import { ScrollToPlugin } from 'gsap/ScrollToPlugin'

gsap.registerPlugin(ScrollTrigger, MotionPathPlugin, ScrollToPlugin)
export default {
  name: 'report',
  mounted() {
    gsap.to('.planet-wrap-1', {
      scrollTrigger: {
        trigger: '.report-hero',
        scrub: true,
        start: 'top top',
        end: '+=100%'
      },
      motionPath: {
        path: '#path-planet-1',
        align: '#path-planet-1',
        alignOrigin: [0.2, 0.5]
      },
      opacity: 0.3
    })
    gsap.to('.planet-wrap-3', {
      scrollTrigger: {
        trigger: '.report-hero',
        scrub: true,
        start: 'top top',
        end: '+=100%'
      },
      motionPath: {
        path: '#path-planet-3',
        align: '#path-planet-3',
        alignOrigin: [0.33, 0.5]
      },
      opacity: 0.3
    })
    gsap.to('.planet-wrap-4', {
      scrollTrigger: {
        trigger: '.report-hero',
        scrub: true,
        start: 'top top',
        end: '+=100%'
      },
      motionPath: {
        path: '#path-planet-4',
        align: '#path-planet-4',
        alignOrigin: [0.23, 0.5]
      },
      opacity: 0.3
    })
    gsap.to('.planet-wrap-5', {
      scrollTrigger: {
        trigger: '.report-hero',
        scrub: true,
        start: 'top top',
        end: '+=100%'
      },
      motionPath: {
        path: '#path-planet-5',
        align: '#path-planet-5',
        alignOrigin: [0.17, 0.5]
      },
      opacity: 0.3
    })
    gsap.to('.planet-wrap-2', {
      scrollTrigger: {
        trigger: '.report-hero',
        pin: true,
        scrub: true,
        start: 'top top',
        end: '+=100%'
      },
      motionPath: {
        path: '#path-planet-2',
        align: '#path-planet-2',
        alignOrigin: [0.25, 0.5]
      },
      opacity: 0.3
    })
    const sections = gsap.utils.toArray('.panel-section')
    let currentIndex = -1
    let animating
    gsap.set('.x-100', { xPercent: 100 })
    gsap.set(sections, {
      zIndex: i => i
    })

    // create an observer and disable it to start
    let intentObserver = ScrollTrigger.observe({
      type: 'wheel,touch',
      onUp: () => !animating && gotoPanel(currentIndex + 1, true),
      onDown: () => !animating && gotoPanel(currentIndex - 1, false),
      wheelSpeed: -1, // to match mobile behavior, invert the wheel speed
      tolerance: 10,
      preventDefault: true,
      onPress: self => {
        ScrollTrigger.isTouch && self.event.preventDefault()
      }
    })
    intentObserver.disable()

    let preventScroll = ScrollTrigger.observe({
      preventDefault: true,
      type: 'wheel,scroll',
      allowClicks: true,
      onEnable: self => self.savedScroll = self.scrollY(), // save the scroll position
      onChangeY: self => self.scrollY(self.savedScroll) // refuse to scroll
    })
    preventScroll.disable()

    // handle the panel swipe animations
    function gotoPanel(index, isScrollingDown) {
      if ((isScrollingDown && currentIndex < sections.length - 1) || (!isScrollingDown && currentIndex > 0)) {
        animating = true
        let target = isScrollingDown ? sections[index] : sections[currentIndex]
        gsap.to(target, {
          xPercent: isScrollingDown ? 0 : 100,
          duration: 0.5,
          onComplete: () => {
            animating = false
          }
        })
        currentIndex = index
      }
    }

    // pin swipe section and initiate observer
    ScrollTrigger.create({
      trigger: '.scroll',
      pin: true,
      anticipatePin: true,
      start: 'top top',
      end: '+=50%',
      onEnter: (self) => {
        if (preventScroll.isEnabled === false) {
          self.scroll(self.start)
          preventScroll.enable()
          intentObserver.enable()
          gotoPanel(currentIndex + 1, true)
        }
      },
      onEnterBack: (self) => {
        if (preventScroll.isEnabled === false) {
          self.scroll(self.start)
          preventScroll.enable()
          intentObserver.enable()
          gotoPanel(currentIndex - 1, false)
        }
      }
    })
  }
}
</script>

<style scoped lang="scss">
* {
  font-family: 'Roboto-Regular', sans-serif;
}

.report-hero {
  background: url('../../assets/header.png')no-repeat top center !important;
  background-size: cover !important;
  height: 100vh;
  overflow: visible;
}

.test {
  height: 100vh;
  background-color: red;
}

.scroll {
  position: relative;
  height: 100vh;
  width: 100%;
  overflow: hidden;

  .panel-section {
    position: absolute;
    width: 100%;
  }
}

.hero-section {
  position: relative;
}

.titlewrap-hero {
  position: absolute;
  bottom: 50%;
  left: 50%;
  transform: translate(-50%, -30%);
  color: #fff;
  text-align: center;

  h1 {
    padding-bottom: 15px;
    font-size: 34px;
    font-weight: 300;
  }
}

.fade-animation {
  animation-name: fade-in-down;
  animation-iteration-count: 1;
  animation-duration: .3s;
  animation-fill-mode: backwards;
}

.breathing-animation {
  animation: breathing 1.5s alternate infinite ease-in
}

.breathing-animation-2 {
  animation: breathing-2 1.5s alternate infinite ease-in
}

.breathing-animation-3 {
  animation: breathing-3 1.5s alternate infinite ease-in
}

@keyframes fade-in-down {
  0% {
    opacity: 0;
  }

  100% {
    opacity: 1;
  }
}

@keyframes breathing {
  100% {
    transform: translate(55px, 0) scale(.9);
  }
}

@keyframes breathing-2 {
  100% {
    transform: translate(45px, 0) scale(.9);
  }
}

@keyframes breathing-3 {
  100% {
    transform: translate(36px, 0) scale(.9);
  }
}

.txt-animation {
  animation-name: fade-in-txt;
  animation-iteration-count: 1;
  animation-delay: 1.3s;
  animation-duration: 1s;
  animation-fill-mode: both;
}

@keyframes fade-in-txt {
  0% {
    opacity: 0;
    transform: translate3d(-50%, -100%, 0);
  }

  100% {
    opacity: 1;
    transform: translate3d(-50%, 0, 0);
  }
}
</style>
